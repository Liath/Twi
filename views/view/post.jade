extends view

block head
    style(type="text/css")
        #sidebar .rule-h-bottom {width: 100%;}
        .filesize, .username {
            color:#006699;
        }
        .statistics {
            color:#777;
        }
        .left {
            float:left;
        }
        #comments table tr {
            margin-left:0;
           margin-bottom:10px;
        }
        #comments table td {
            display:table-cell !important;
            min-height:50px;
        }
        #comments table {
            margin-bottom:20px;
        }
        #comments {
            padding-top: 30px;
            color:#AAA;
            margin-left: 0;
        }
        #preview {
        }
        .comment-info {
            text-align:right;
        }
        .comment-message {
            padding-left:10px;
            -webkit-box-shadow: rgba(255, 255, 255, 0.07) 1px 0 0 inset;
            -moz-box-shadow: rgba(255, 255, 255, 0.07) 1px 0 0 inset;
            box-shadow: rgba(255, 255, 255, 0.07) 1px 0 0 inset;
            border-left: 1px solid #242424;
            margin-left: 10px !important;
        }
        .imageLinks h3 {
            display:inline;
        }

block append sidebar
    - //Modified from http://www.zachleat.com/Lib/jquery/humane.js
    - //I just removed the centuries stuff as it was unlikely to be needed here.
    - function humane_date(e){var f=[[60,"Just Now"],[90,"1 Minute"],[3600,"Minutes",60],[5400,"1 Hour"],[86400,"Hours",3600],[129600,"1 Day"],[604800,"Days",86400],[907200,"1 Week"],[2628E3,"Weeks",604800],[3942E3,"1 Month"],[31536E3,"Months",2628E3],[47304E3,"1 Year"],[31536E5,"Years",31536E3]],a=(""+e).replace(/-/g,"/").replace(/[TZ]/g," "),b=new Date,a=(b-new Date(a)+6E4*b.getTimezoneOffset())/1E3,b=" ago",d=0,c;0>a&&(a=Math.abs(a),b="");for(;c=f[d++];)if(a<c[0])return 2==c.length?c[1]+(1<d?b:""):Math.round(a/c[2])+" "+c[1]+(1<d?b:"");return e}

    - //I love closure :3
    - function prettyByte(a){var b=+Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,b)).toFixed(b?1:0)+" "+["n/a","bytes","kb","mb","gb"][isNaN(a)?0:b+1]};

    .rule-h-bottom
    span.statistics
        h3 Statistics
        span Posted #{humane_date(image.u.toISOString())} by
            span.username &nbsp;#{image.m.u}
        br
        span Size:
            span.filesize #{image.m.d.w}x#{image.m.d.h} (#{prettyByte(image.m.s)})
        br
        if (image.d.length > 0)
            span Source:
                a.sourcelink(href=image.d) #{image.d}
            br
        if (typeof(image.m.r) != 'undefined')
            span Rating:
                span.rating #{image.m.r}
            br
        span Score:
            span.badge #{image.r}
        br
        span Views:
            span.badge #{image.v}

block append main
    #body.span10.rule-v-left
        #image.span12.rule-h-bottom
            img(src=image.f, height="600px")
            .imageLinks
                a(href='#')
                    h3 Edit
                h3 &nbsp;|&nbsp;
                a(href=image.f)
                    h3 Download
        #comments.span10
            if (image.c.length > 0)
                table.span12
                    tbody.span12
                        for comment in image.c
                            tr.span12
                                td.comment-info.span2
                                    span.username #{comment.a}
                                    br
                                    #{humane_date(comment.t.toISOString())}
                                td.span10.comment-message
                                    span #{comment.m}
            #addComment.span6
                form.span12(action="/s/comment/"+image.a, method="post")
                    textarea.span12(name="message")
                    .btn-group.left
                        input.btn.btn-success(type="submit", value="Submit")
                        a.btn.btn-info#preview Preview

block append scripts
    script
        $('#image img').click(function() {
            if ($('#image img').attr('height') != '600px') $('#image img').attr('height', '600px')
            else $('#image img').attr('height', '')
        });